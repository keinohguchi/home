#!/bin/sh

usage() { printf "wifi name [ifname]" >&2; exit 1; }
error()
{
	local msg=${1:-"Someting wrong"}
	local ret=${2:-1}
	printf "%s\n" "$msg"
	exit $ret
}

## arguments
case $# in
	[0-2]) ;; # we take either 0, 1, or 2 options
	*) usage ;;
esac
network=${1:-home}
ifname=${2:-wlp3s0}

## network variable validity check
home=/etc/wpa_supplicant
NEW_CONF=$home/${network}.conf
[ ! -f "$NEW_CONF" ] && error "No such file: $NEW_CONF"

WPA_CONF=$home/wpa_supplicant-$ifname.conf
RSV_CONF=/etc/resolv.conf
RSV_SYSD=/run/systemd/resolve/resolv.conf
SRV_CMD="systemctl restart wpa_supplicant@$ifname"
NET_CMD="systemctl restart systemd-networkd"

x=sudo

if [ ! -f "$NEW_CONF" ]; then
	printf "No such file: $NEW_CONF\n"
	exit 1
fi

if [ -f "$WPA_CONF" ]; then
	$x rm $WPA_CONF
fi

if [ -a "$RSV_CONF" -o -h "$RSV_CONF" ]; then
	$x rm $RSV_CONF
fi

$x ln -s $NEW_CONF $WPA_CONF
$x ln -s $RSV_SYSD $RSV_CONF
$x $SRV_CMD
$x $NET_CMD
